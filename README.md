# üöÄ Sistema de Demandas Flask

Sistema completo de gest√£o de demandas, pedidos e indicadores desenvolvido em Flask com interface moderna e responsiva.

## üìã Vis√£o Geral

Este sistema oferece uma solu√ß√£o completa para gest√£o empresarial com os seguintes m√≥dulos:

- üéØ **Demandas**: Controle de solicita√ß√µes e cota√ß√µes
- üõí **Pedidos**: Gest√£o de pedidos e faturamento  
- üåê **Rede Social**: Posts e comunica√ß√£o interna
- üìä **PM05**: Indicadores de performance
- üìà **GI**: Gest√£o de indicadores semanais
- üë• **Usu√°rios**: Sistema de autentica√ß√£o e permiss√µes

## ‚ú® Funcionalidades

### üîê Sistema de Autentica√ß√£o
- Login/logout de usu√°rios
- Controle de permiss√µes (admin/usu√°rio)
- Usu√°rio admin padr√£o inclu√≠do

### üìä Dashboard Interativo
- Cards de estat√≠sticas
- Gr√°ficos e m√©tricas em tempo real
- Filtros por ano e per√≠odo
- Interface responsiva

### üé® Interface Moderna
- Design Bootstrap 5
- PWA (Progressive Web App)
- Favicon personalizado
- Tema escuro/claro

### üì± Recursos T√©cnicos
- SQLite/MySQL suportados
- Migrations autom√°ticas
- Upload de arquivos
- API RESTful

## üõ†Ô∏è Tecnologias

- **Backend**: Flask 2.3.3, SQLAlchemy
- **Frontend**: Bootstrap 5, Font Awesome, JavaScript
- **Banco**: SQLite (padr√£o) / MySQL (produ√ß√£o)
- **Deploy**: Python 3.8+

## üì¶ Instala√ß√£o

### 1. Clone o Reposit√≥rio
```bash
git clone https://github.com/hendelsantos/sistema-demandas-flask.git
cd sistema-demandas-flask
```

### 2. Ambiente Virtual
```bash
# Criar ambiente virtual
python -m venv venv

# Ativar ambiente virtual
# Windows:
venv\Scripts\activate
# Linux/Mac:
source venv/bin/activate
```

### 3. Instalar Depend√™ncias
```bash
pip install -r requirements.txt
```

## üöÄ Execu√ß√£o R√°pida (SQLite)

### 1. Inicializar Banco
```bash
# Criar usu√°rio admin
python criar_admin.py

# Executar aplica√ß√£o
python app.py
```

### 2. Acessar Sistema
- **URL**: http://localhost:5000
- **Admin**: admin / admin123
- **P√∫blico**: Alguns m√≥dulos acess√≠veis sem login

## üê¨ Configura√ß√£o MySQL (Produ√ß√£o)

### 1. Instalar MySQL
```bash
# Ubuntu/Debian
sudo apt update
sudo apt install mysql-server

# CentOS/RHEL
sudo yum install mysql-server

# Iniciar servi√ßo
sudo systemctl start mysql
sudo systemctl enable mysql
```

### 2. Configurar Banco
```sql
# Conectar como root
mysql -u root -p

# Criar banco
CREATE DATABASE sistema_demandas CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

# Criar usu√°rio (opcional)
CREATE USER 'app_user'@'localhost' IDENTIFIED BY 'senha_segura';
GRANT ALL PRIVILEGES ON sistema_demandas.* TO 'app_user'@'localhost';
FLUSH PRIVILEGES;
EXIT;
```

### 3. Configurar Credenciais
Edite o arquivo `migrar_sqlite_mysql.py`:
```python
MYSQL_CONFIG = {
    'host': 'localhost',
    'port': 3306,
    'user': 'root',              # Seu usu√°rio
    'password': 'sua_senha',     # Sua senha
    'database': 'sistema_demandas',
    'charset': 'utf8mb4'
}
```

### 4. Migra√ß√£o Autom√°tica
```bash
# Testar conex√£o
python testar_mysql.py

# Migrar dados do SQLite para MySQL
python migrar_sqlite_mysql.py
```

### 5. Ativar MySQL no App
Edite `app.py` e descomente as linhas MySQL:
```python
# Comentar SQLite
# app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///demandas.db'

# Descomentar MySQL
if os.getenv('MYSQL_HOST'):
    mysql_user = os.getenv('MYSQL_USER', 'root')
    mysql_password = os.getenv('MYSQL_PASSWORD', '')
    mysql_host = os.getenv('MYSQL_HOST', 'localhost')
    mysql_port = os.getenv('MYSQL_PORT', '3306')
    mysql_database = os.getenv('MYSQL_DATABASE', 'sistema_demandas')
    app.config['SQLALCHEMY_DATABASE_URI'] = f'mysql+pymysql://{mysql_user}:{mysql_password}@{mysql_host}:{mysql_port}/{mysql_database}?charset=utf8mb4'
    print("üîó Conectando ao MySQL...")
else:
    app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///demandas.db'
    print("üîó Conectando ao SQLite...")
```

### 6. Configurar Vari√°veis de Ambiente
Crie o arquivo `.env`:
```env
# MySQL
MYSQL_HOST=localhost
MYSQL_PORT=3306
MYSQL_USER=root
MYSQL_PASSWORD=sua_senha
MYSQL_DATABASE=sistema_demandas

# Aplica√ß√£o
SECRET_KEY=sua-chave-secreta-super-segura
FLASK_ENV=production
FLASK_DEBUG=False
```

### 7. Executar com MySQL
```bash
python app.py
```

## üîß Configura√ß√£o de Servidor

### Nginx (Recomendado)
```nginx
server {
    listen 80;
    server_name seu-dominio.com;

    location / {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

### Gunicorn (Produ√ß√£o)
```bash
# Instalar Gunicorn
pip install gunicorn

# Executar
gunicorn -w 4 -b 0.0.0.0:5000 app:app
```

### Systemd Service
```ini
[Unit]
Description=Sistema Demandas Flask
After=network.target

[Service]
User=www-data
WorkingDirectory=/path/to/app
Environment="PATH=/path/to/app/venv/bin"
ExecStart=/path/to/app/venv/bin/gunicorn -w 4 -b 127.0.0.1:5000 app:app
Restart=always

[Install]
WantedBy=multi-user.target
```

## üìä Estrutura do Banco

### Tabelas Principais
- `demanda` - Demandas e cota√ß√µes
- `pedido` - Pedidos e faturamento
- `usuario` - Usu√°rios e permiss√µes
- `post_rede_social` - Posts da rede social
- `pm05` - Indicadores PM05
- `gi_indicadores` - Indicadores GI semanais

### Relacionamentos
- Usu√°rios t√™m permiss√µes admin/user
- Demandas geram pedidos
- Posts pertencem a usu√°rios
- Indicadores s√£o filtrados por ano

## üéØ Uso do Sistema

### üîê Login
1. Acesse http://localhost:5000/login
2. Use: admin / admin123
3. Ou crie novos usu√°rios via admin

### üìä Dashboard
- Vis√£o geral de todos os m√≥dulos
- Estat√≠sticas em tempo real
- Acesso r√°pido √†s funcionalidades

### M√≥dulos Detalhados

#### üìã Gest√£o de Demandas
- **Cadastro de Demandas**: Solicitante, descri√ß√£o, quantidade, cat√°logo, local de uso e justificativa
- **Controle de Status**: 
  - Aberto ‚Üí Em Cota√ß√£o ‚Üí PR Criada ‚Üí PO Emitido
- **Upload de Documentos**: Anexar PDFs (cota√ß√µes, especifica√ß√µes, POs, notas fiscais)
- **Timeline Visual**: Acompanhamento do fluxo do processo

#### üõí Gest√£o de Pedidos
- **Cria√ß√£o de Pedidos**: Vinculados √†s demandas com PO emitido
- **Controle de Fornecedores**: Dados do fornecedor e n√∫mero da PO
- **Gest√£o de Recebimento**: Confirma√ß√£o de recebimento com valores reais
- **Notas Fiscais**: Controle de documentos fiscais

#### üìä M√©tricas e Relat√≥rios
- **Previs√µes vs Recebido**: Comparativo mensal de valores
- **Gr√°ficos Interativos**: Visualiza√ß√£o de dados financeiros
- **M√©tricas em Tempo Real**: Dashboard com indicadores principais
- **Proje√ß√µes Futuras**: Previs√µes de recebimento por m√™s

#### üìà Indicadores GI
1. Inserir dados semanais
2. Filtrar por ano
3. Ver estat√≠sticas
4. Editar/excluir registros

#### üåê Rede Social
1. Criar posts
2. Editar/excluir (admin)
3. Intera√ß√£o social
4. Comunica√ß√£o interna

## üîß Desenvolvimento

### Estrutura de Arquivos
```
sistema-demandas-flask/
‚îú‚îÄ‚îÄ app.py                 # Aplica√ß√£o principal
‚îú‚îÄ‚îÄ gi.py                  # M√≥dulo GI
‚îú‚îÄ‚îÄ pm05.py               # M√≥dulo PM05
‚îú‚îÄ‚îÄ rede_social.py        # M√≥dulo Rede Social
‚îú‚îÄ‚îÄ criar_admin.py        # Script criar admin
‚îú‚îÄ‚îÄ migrar_sqlite_mysql.py # Script migra√ß√£o
‚îú‚îÄ‚îÄ requirements.txt      # Depend√™ncias
‚îú‚îÄ‚îÄ templates/            # Templates HTML
‚îú‚îÄ‚îÄ static/              # CSS, JS, imagens
‚îú‚îÄ‚îÄ instance/            # Banco SQLite
‚îî‚îÄ‚îÄ uploads/             # Arquivos enviados
```

### Comandos √öteis
```bash
# Instalar nova depend√™ncia
pip install nome-pacote
pip freeze > requirements.txt

# Backup banco
cp instance/demandas.db backup_$(date +%Y%m%d).db

# Ver logs
tail -f /var/log/nginx/access.log

# Reiniciar servi√ßo
sudo systemctl restart nome-servico
```

## üö® Troubleshooting

### Erro de Conex√£o MySQL
```bash
# Verificar se MySQL est√° rodando
sudo systemctl status mysql

# Testar conex√£o
python testar_mysql.py

# Verificar logs
sudo tail -f /var/log/mysql/error.log
```

### Erro de Permiss√µes
```bash
# Corrigir permiss√µes uploads
chmod 755 uploads/
chown -R www-data:www-data uploads/

# Corrigir banco SQLite
chmod 664 instance/demandas.db
chown www-data:www-data instance/demandas.db
```

### Erro de Depend√™ncias
```bash
# Reinstalar depend√™ncias
pip uninstall -r requirements.txt -y
pip install -r requirements.txt

# Limpar cache
pip cache purge
```

## üìû Suporte

### Logs da Aplica√ß√£o
- **SQLite**: Logs no terminal
- **MySQL**: /var/log/mysql/
- **Nginx**: /var/log/nginx/
- **App**: Configurar logging no Flask

### Contato
- **Desenvolvedor**: Hendel Santos
- **Email**: [seu-email@example.com]
- **GitHub**: https://github.com/hendelsantos/sistema-demandas-flask

## üìù Licen√ßa

Este projeto est√° sob a licen√ßa MIT. Veja o arquivo `LICENSE` para mais detalhes.

## üèÜ Vers√£o

**Vers√£o 1.02** - Sistema completo com todos os m√≥dulos funcionais

---

‚≠ê **Desenvolvido com ‚ù§Ô∏è por Hendel Santos**
- **Gr√°ficos Interativos**: Visualiza√ß√£o de dados financeiros
- **M√©tricas em Tempo Real**: Dashboard com indicadores principais
- **Proje√ß√µes Futuras**: Previs√µes de recebimento por m√™s

## Tecnologias Utilizadas

### Backend
- **Python 3.8+**
- **Flask** - Framework web
- **SQLAlchemy** - ORM para banco de dados
- **Flask-Migrate** - Migra√ß√µes de banco
- **SQLite** - Banco de dados (desenvolvimento)

### Frontend
- **HTML5** e **CSS3**
- **Bootstrap 5** - Framework CSS
- **JavaScript ES6+**
- **Chart.js** - Gr√°ficos interativos
- **Font Awesome** - √çcones

## Instala√ß√£o e Configura√ß√£o

### 1. Clonar o reposit√≥rio
```bash
git clone <url-do-repositorio>
cd Sistema_demandas_flask
```

### 2. Criar ambiente virtual
```bash
python -m venv venv

# Linux/Mac
source venv/bin/activate

# Windows
venv\Scripts\activate
```

### 3. Instalar depend√™ncias
```bash
pip install -r requirements.txt
```

### 4. Configurar vari√°veis de ambiente
```bash
# Copiar arquivo de exemplo
cp .env.example .env

# Editar .env com suas configura√ß√µes
nano .env
```

### 5. Inicializar banco de dados
```bash
# Criar migra√ß√µes
flask db init
flask db migrate -m "Initial migration"
flask db upgrade
```

### 6. Executar aplica√ß√£o
```bash
python app.py
```

A aplica√ß√£o estar√° dispon√≠vel em: `http://localhost:5000`

## Credenciais Padr√£o

O sistema cria automaticamente um usu√°rio administrador para facilitar o primeiro acesso:

- **Usu√°rio**: `admin`
- **Senha**: `admin123`

### Tipos de Usu√°rio

#### üë®‚Äçüíº Administrador
- Criar, editar e deletar demandas
- Atualizar status das demandas
- Gerenciar pedidos e recebimentos
- Visualizar todas as m√©tricas
- Acesso completo ao sistema

#### üë§ Usu√°rio Comum
- Criar novas demandas
- Visualizar demandas existentes
- Anexar documentos
- Visualizar m√©tricas
- Acesso somente leitura para pedidos

> **Importante**: Ap√≥s o primeiro acesso, √© recomendado alterar a senha padr√£o do administrador e criar usu√°rios espec√≠ficos para cada pessoa da equipe.

## Estrutura do Projeto

```
Sistema_demandas_flask/
‚îú‚îÄ‚îÄ app.py                 # Aplica√ß√£o principal
‚îú‚îÄ‚îÄ requirements.txt       # Depend√™ncias Python
‚îú‚îÄ‚îÄ .env.example          # Exemplo de configura√ß√£o
‚îú‚îÄ‚îÄ README.md             # Este arquivo
‚îú‚îÄ‚îÄ static/               # Arquivos est√°ticos
‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ style.css     # Estilos personalizados
‚îÇ   ‚îî‚îÄ‚îÄ js/
‚îÇ       ‚îî‚îÄ‚îÄ script.js     # JavaScript personalizado
‚îú‚îÄ‚îÄ templates/            # Templates HTML
‚îÇ   ‚îú‚îÄ‚îÄ base.html         # Template base
‚îÇ   ‚îú‚îÄ‚îÄ index.html        # P√°gina inicial
‚îÇ   ‚îú‚îÄ‚îÄ dashboard.html    # Dashboard principal
‚îÇ   ‚îú‚îÄ‚îÄ nova_demanda.html # Formul√°rio de nova demanda
‚îÇ   ‚îú‚îÄ‚îÄ listar_demandas.html # Lista de demandas
‚îÇ   ‚îú‚îÄ‚îÄ detalhes_demanda.html # Detalhes da demanda
‚îÇ   ‚îú‚îÄ‚îÄ listar_pedidos.html # Lista de pedidos
‚îÇ   ‚îú‚îÄ‚îÄ novo_pedido.html  # Formul√°rio de novo pedido
‚îÇ   ‚îî‚îÄ‚îÄ metricas.html     # M√©tricas e gr√°ficos
‚îú‚îÄ‚îÄ uploads/              # Arquivos enviados (criado automaticamente)
‚îî‚îÄ‚îÄ migrations/           # Migra√ß√µes do banco (criado automaticamente)
```

## Uso do Sistema

### 1. Criar Nova Demanda
1. Acesse "Nova Demanda" no menu
2. Preencha todos os campos obrigat√≥rios
3. Salve a demanda (status inicial: "Aberto")

### 2. Gerenciar Status
1. Acesse os detalhes da demanda
2. Use o painel "Controle de Status" para atualizar
3. Acompanhe o progresso na timeline

### 3. Anexar Documentos
1. Na tela de detalhes da demanda
2. Selecione o tipo de documento
3. Fa√ßa upload do arquivo PDF
4. Documentos ficam organizados por tipo

### 4. Criar Pedido
1. Quando demanda estiver com "PO Emitido"
2. Clique em "Criar Pedido"
3. Preencha dados do fornecedor e valores
4. Defina previs√£o de recebimento

### 5. Confirmar Recebimento
1. Na lista de pedidos
2. Clique no bot√£o de confirma√ß√£o
3. Informe o valor real recebido
4. Sistema atualiza m√©tricas automaticamente

### 6. Acompanhar M√©tricas
1. Acesse "M√©tricas" no menu
2. Visualize gr√°ficos de previs√£o vs recebido
3. Acompanhe proje√ß√µes futuras
4. Analise performance por m√™s

## Fluxo do Processo

```
1. DEMANDA CRIADA
   ‚Üì (Status: Aberto)
   
2. ENVIO PARA COTA√á√ÉO
   ‚Üì (Status: Em Cota√ß√£o)
   
3. PR CRIADA
   ‚Üì (Status: PR Criada)
   
4. PO EMITIDO
   ‚Üì (Status: PO Emitido)
   
5. PEDIDO CRIADO
   ‚Üì (Vinculado √† demanda)
   
6. RECEBIMENTO CONFIRMADO
   ‚Üì (M√©tricas atualizadas)
```

## Personaliza√ß√£o

### Adicionar Novos Status
1. Edite o modelo `Demanda` em `app.py`
2. Atualize os templates HTML
3. Adicione valida√ß√µes necess√°rias

### Modificar Tipos de Arquivo
1. Altere a valida√ß√£o em `upload_arquivo()`
2. Atualize o frontend para novos tipos
3. Modifique as op√ß√µes de sele√ß√£o

### Customizar M√©tricas
1. Edite a rota `/api/metricas_chart`
2. Modifique queries SQL conforme necess√°rio
3. Atualize gr√°ficos no frontend

## Seguran√ßa

- ‚úÖ Valida√ß√£o de uploads (apenas PDF)
- ‚úÖ Sanitiza√ß√£o de nomes de arquivo
- ‚úÖ Controle de tamanho de arquivo
- ‚úÖ Tokens CSRF nos formul√°rios
- ‚úÖ Valida√ß√£o de dados no backend

## Backup e Manuten√ß√£o

### Backup do Banco
```bash
# SQLite
cp demandas.db backup_$(date +%Y%m%d).db
```

### Backup de Arquivos
```bash
# Pasta uploads
tar -czf uploads_backup_$(date +%Y%m%d).tar.gz uploads/
```

### Logs
- Logs s√£o exibidos no console durante desenvolvimento
- Para produ√ß√£o, configure logging adequado

## Suporte e Desenvolvimento

### Requisitos do Sistema
- Python 3.8 ou superior
- 512MB RAM m√≠nimo
- 1GB espa√ßo em disco
- Navegador moderno (Chrome, Firefox, Safari, Edge)

### Contribui√ß√£o
1. Fork o projeto
2. Crie branch para feature (`git checkout -b feature/nova-funcionalidade`)
3. Commit suas mudan√ßas (`git commit -am 'Adiciona nova funcionalidade'`)
4. Push para branch (`git push origin feature/nova-funcionalidade`)
5. Abra Pull Request

## Licen√ßa

Este projeto est√° sob licen√ßa MIT. Veja o arquivo LICENSE para mais detalhes.

## Contato

Para d√∫vidas ou sugest√µes, entre em contato atrav√©s dos issues do reposit√≥rio.
